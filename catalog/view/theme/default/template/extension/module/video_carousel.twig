{% if video_items|length > 0 %}
{% if format == 'carousel' %}
<div class="video-carousel swiper-viewport">
  <div id="video-carousel{{ module }}" class="swiper-container">
    <div class="swiper-wrapper">
      {% for video_item in video_items %}
      <div class="swiper-slide text-center">
        <div class="video-item" data-video-url="{{ video_item.embed_url }}" data-title="{{ video_item.title }}">
          <a href="#" class="video-thumbnail" onclick="return false;">
            {% if video_item.thumb %}
            <img src="{{ video_item.thumb }}" alt="{{ video_item.title }}" class="img-responsive" />
            {% else %}
            <div class="video-placeholder">
              {% if video_item.title %}
              <div class="video-placeholder-title">{{ video_item.title }}</div>
              {% else %}
              <div class="video-placeholder-icon"><i class="fa fa-video-camera"></i></div>
              {% endif %}
            </div>
            {% endif %}
            <div class="play-overlay">
              <i class="fa fa-play-circle"></i>
            </div>
          </a>
          {% if video_item.thumb and video_item.title %}
          <div class="video-title">{{ video_item.title }}</div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="swiper-pagination video-carousel{{ module }}"></div>
  <div class="swiper-pager">
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
</div>
<script type="text/javascript"><!--
$('#video-carousel{{ module }}').swiper({
	mode: 'horizontal',
	slidesPerView: 3,
  spaceBetween: 10,
	pagination: '.video-carousel{{ module }}',
	paginationClickable: true,
	nextButton: '.video-carousel .swiper-button-next',
  prevButton: '.video-carousel .swiper-button-prev',
	autoplay: 2500,
	loop: true,
	breakpoints: {
		640: {
			slidesPerView: 2,
			spaceBetween: 10
		},
		768: {
			slidesPerView: 3,
			spaceBetween: 10
		},
		1024: {
			slidesPerView: 4,
			spaceBetween: 10
		}
	}
});
//--></script>
{% else %}
<div class="video-grid">
  <div class="row">
    {% for video_item in video_items %}
    <div class="col-12 col-md-6">
      <div class="video-item" data-video-url="{{ video_item.embed_url }}" data-title="{{ video_item.title }}">
        <a href="#" class="video-thumbnail" onclick="return false;">
          {% if video_item.image %}
          <img src="{{ video_item.image }}" alt="{{ video_item.title }}" class="img-responsive" />
          {% else %}
          <div class="video-placeholder">
            {% if video_item.title %}
            <div class="video-placeholder-title">{{ video_item.title }}</div>
            {% else %}
            <div class="video-placeholder-icon"><i class="fa fa-video-camera"></i></div>
            {% endif %}
          </div>
          {% endif %}
          <div class="play-overlay">
            <i class="fa fa-play-circle"></i>
          </div>
        </a>
        {% if video_item.image and video_item.title %}
        <div class="video-title">{{ video_item.title }}</div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}
{% endif %}

{% if video_items|length > 0 %}
<!-- Modal para exibir o vídeo -->
<div class="modal fade" id="videoModal{{ module }}" tabindex="-1" role="dialog" aria-labelledby="videoModalLabel{{ module }}">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="videoModalLabel{{ module }}"></h4>
      </div>
      <div class="modal-body">
        <div class="embed-responsive embed-responsive-16by9">
          <iframe id="videoIframe{{ module }}" class="embed-responsive-item" src="" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<style>
.video-carousel{
    margin: 60px 0 60px !important;
}

.video-item {
  position: relative;
  margin-bottom: 20px;
  cursor: pointer;
  width:100%;
}

.video-thumbnail {
  position: relative;
  display: block;
  overflow: hidden;
}

.video-thumbnail img {
  width: 100%;
  height: auto;
  transition: transform 0.3s;
}

.video-item:hover .video-thumbnail img {
  transform: scale(1.05);
}

.video-placeholder {
  width: 100%;
  min-height: 200px;
  background-color: #F2F2F2;
  display: flex;
  align-items: start;
  justify-content: center;
  padding: 20px;
  transition: background-color 0.3s;
}

.video-item:hover .video-placeholder {
  background-color: #E8E8E8;
}

.video-placeholder-title {
  font-size: 18px;
  font-weight: bold;
  color: #666;
  text-align: center;
  word-wrap: break-word;
  max-width: 100%;
}

.video-placeholder-icon {
  font-size: 48px;
  color: #999;
}

.video-grid .video-placeholder {
  min-height: 300px;
}

.play-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.7);
  border-radius: 50%;
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.play-overlay i {
  font-size: 40px;
  color: #fff;
}

.video-item:hover .play-overlay {
  background: rgba(255, 0, 0, 0.8);
  transform: translate(-50%, -50%) scale(1.1);
}

.video-title {
  margin-top: 10px;
  text-align: center;
  font-weight: bold;
}

.video-grid .video-item {
  margin-bottom: 30px;
}

.modal-body {
  padding: 20px;
}

.close {
  font-size: 28px;
  font-weight: bold;
}
</style>

<script type="text/javascript"><!--
$(document).ready(function() {
  {% if video_items|length > 0 %}
  // Evento para abrir a modal e carregar o vídeo
  $(document).on('click', '#video-carousel{{ module }} .video-item, .video-grid .video-item', function(e) {
    e.preventDefault();
    
    const videoUrl = $(this).data('video-url');
    const videoTitle = $(this).data('title');
    
    if (!videoUrl) {
      return;
    }
    
    // Atualizar título da modal
    $('#videoModalLabel{{ module }}').text(videoTitle || 'Vídeo');
    
    // Carregar o iframe apenas quando a modal for aberta, com autoplay
    var autoplayUrl = videoUrl.indexOf('?') === -1 ? (videoUrl + '?autoplay=1') : (videoUrl + '&autoplay=1');
    $('#videoIframe{{ module }}').attr('src', autoplayUrl);
    
    // Abrir modal
    $('#videoModal{{ module }}').modal('show');
  });
  
  // Evento para limpar o iframe quando a modal for fechada
  $('#videoModal{{ module }}').on('hidden.bs.modal', function() {
    // Remover o src do iframe para parar a reprodução e destruir o iframe
    const iframe = $('#videoIframe{{ module }}');
    iframe.attr('src', '');
    // Remover o conteúdo do iframe para garantir que não continue rodando
    iframe.replaceWith(iframe.clone());
  });
  {% endif %}
});
//--></script>
